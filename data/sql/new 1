SELECT *, (cs.comprados - cs.vendidos + cs.cant_dev), 
	(
		SELECT CONCAT('update detalle_resumen set cantidad = ', (cs.comprados - cs.vendidos + cs.cant_dev), ' where id = ', max(dr.id) )
		FROM detalle_resumen dr 
				JOIN resumen r ON dr.resumen_id = r.id
		WHERE 
			r.tipofactura_id = 4
			AND r.cliente_id IN (185, 54)
			and dr.producto_id = cs.producto_id 
			AND dr.nro_lote = cs.nro_lote 
			AND dr.cantidad > abs(cs.comprados - cs.vendidos + cs.cant_dev)
	)
FROM control_stock cs
WHERE cs.stock_guardado = 0 AND (cs.comprados - cs.vendidos + cs.cant_dev) <> stock_guardado


delete from detalle_resumen where id = 15832;
delete from detalle_resumen where id = 15831;
delete from detalle_resumen where id = 15824;
delete from detalle_resumen where id = 15471;
delete from detalle_resumen where id = 15468;
delete from detalle_resumen where id = 15430;
delete from detalle_resumen where id = 15470;
delete from detalle_resumen where id = 15820;
delete from detalle_resumen where id = 12485;
delete from detalle_resumen where id = 11507;
delete from detalle_resumen where id = 15808;
update detalle_resumen set cantidad = cantidad-3 where id = 17667;
update detalle_resumen set cantidad = cantidad-2 where id = 16354;
update detalle_resumen set cantidad = cantidad-2 where id = 15808;
update detalle_resumen set cantidad = cantidad-2 where id = 12485;
update detalle_resumen set cantidad = cantidad-1 where id = 17686;
update detalle_resumen set cantidad = cantidad-1 where id = 17513;
update detalle_resumen set cantidad = cantidad-1 where id = 17202;
update detalle_resumen set cantidad = cantidad-1 where id = 15818;
update detalle_resumen set cantidad = cantidad-1 where id = 15444;
update detalle_resumen set cantidad = cantidad-1 where id = 15416;